{
	"name": "ePickEncounter",
	"events": [
		{
			"eventType": "variable",
			"name": "EnemyArraysCleared",
			"type": "number",
			"initialValue": "0",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 692084591539048
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-start-of-layout",
					"objectClass": "System",
					"sid": 200865265438936
				}
			],
			"actions": [
				{
					"type": "comment",
					"text": "probably want to move this out to the town layout"
				}
			],
			"sid": 351281286189692,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "has-key",
							"objectClass": "JSON",
							"sid": 807469061180858,
							"parameters": {
								"path": "\"enemies\""
							},
							"isInverted": true
						}
					],
					"actions": [
						{
							"id": "request-project-file",
							"objectClass": "AJAX",
							"sid": 443345033236921,
							"parameters": {
								"tag": "\"enemies\"",
								"file": "enemies.json"
							}
						}
					],
					"sid": 257435704431824
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "else",
							"objectClass": "System",
							"sid": 395643067778894
						}
					],
					"actions": [
						{
							"callFunction": "PostAjaxFunction",
							"sid": 294040892104431
						}
					],
					"sid": 523385790391406
				}
			]
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-completed",
					"objectClass": "AJAX",
					"sid": 533912917794553,
					"parameters": {
						"tag": "\"enemies\""
					}
				}
			],
			"actions": [
				{
					"id": "set-json",
					"objectClass": "JSON",
					"sid": 657621207687702,
					"parameters": {
						"path": "\"enemies\"",
						"json": "AJAX.LastData"
					}
				},
				{
					"callFunction": "SetUpEnemiesArray",
					"sid": 545991484473566
				},
				{
					"callFunction": "PostAjaxFunction",
					"sid": 152967566013431
				}
			],
			"sid": 740965243265694
		},
		{
			"functionName": "PostAjaxFunction",
			"functionDescription": "",
			"functionCategory": "Pick Encounter",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "function-block",
			"conditions": [],
			"actions": [],
			"sid": 428400671250013,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-boolean-eventvar",
							"objectClass": "System",
							"sid": 808945844204342,
							"parameters": {
								"variable": "WonLastBattle"
							}
						}
					],
					"actions": [],
					"sid": 763836550543560,
					"children": [
						{
							"eventType": "block",
							"conditions": [],
							"actions": [
								{
									"id": "sort",
									"objectClass": "LastChosenEnemiesArray",
									"sid": 356834010199760,
									"parameters": {
										"axis": "x"
									}
								},
								{
									"id": "reverse",
									"objectClass": "LastChosenEnemiesArray",
									"sid": 964909752639193,
									"parameters": {
										"axis": "x"
									}
								}
							],
							"sid": 221481118707112
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "for-each-element",
									"objectClass": "LastChosenEnemiesArray",
									"sid": 752693557099821,
									"parameters": {
										"axes": "x"
									}
								}
							],
							"actions": [
								{
									"id": "delete",
									"objectClass": "EnemiesArray",
									"sid": 611068282128676,
									"parameters": {
										"index": "LastChosenEnemiesArray.CurValue",
										"axis": "x"
									}
								}
							],
							"sid": 835159586809073
						},
						{
							"eventType": "comment",
							"text": "We don't have enough enemies to show for selection, so reload deck for now (in future, back to town)"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-two-values",
									"objectClass": "System",
									"sid": 557366669449970,
									"parameters": {
										"first-value": "EnemiesArray.Width",
										"comparison": 2,
										"second-value": "EnemyContainer.Count"
									}
								}
							],
							"actions": [
								{
									"id": "add-to-eventvar",
									"objectClass": "System",
									"sid": 740318545834694,
									"parameters": {
										"variable": "EnemyArraysCleared",
										"value": "1"
									}
								},
								{
									"callFunction": "SetUpEnemiesArray",
									"sid": 128357226067838
								}
							],
							"sid": 479989084211131
						},
						{
							"eventType": "block",
							"conditions": [],
							"actions": [
								{
									"callFunction": "DetermineEnemyChoices",
									"sid": 786723049513449
								}
							],
							"sid": 484114785736106
						}
					]
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "else",
							"objectClass": "System",
							"sid": 502137487550298
						}
					],
					"actions": [
						{
							"callFunction": "ReloadEnemyChoices",
							"sid": 276963361559816
						}
					],
					"sid": 100036001108271
				}
			]
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-tap-object",
					"objectClass": "Touch",
					"sid": 998543869372476,
					"parameters": {
						"object": "Enemy"
					}
				}
			],
			"actions": [
				{
					"id": "set-eventvar-value",
					"objectClass": "System",
					"sid": 904032125106480,
					"parameters": {
						"variable": "CurrentEnemyName",
						"value": "EnemyContainer.Name"
					}
				},
				{
					"id": "set-eventvar-value",
					"objectClass": "System",
					"sid": 598831102764453,
					"parameters": {
						"variable": "CurrentEnemyMaxHP",
						"value": "Enemy.MaxHP"
					}
				},
				{
					"id": "go-to-layout",
					"objectClass": "System",
					"sid": 721877879633385,
					"parameters": {
						"layout": "Combat"
					}
				}
			],
			"sid": 363490431279996
		},
		{
			"functionName": "ReloadEnemyChoices",
			"functionDescription": "",
			"functionCategory": "Pick Encounter",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "function-block",
			"conditions": [],
			"actions": [],
			"sid": 135876087241907,
			"children": [
				{
					"eventType": "variable",
					"name": "EnemyArrayIndex",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 825658105709998
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "for-each-ordered",
							"objectClass": "System",
							"sid": 818197597188525,
							"parameters": {
								"object": "EnemyContainer",
								"expression": "EnemyContainer.X",
								"order": "ascending"
							}
						}
					],
					"actions": [
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 270763124805075,
							"parameters": {
								"variable": "EnemyArrayIndex",
								"value": "LastChosenEnemiesArray.At(loopindex)"
							}
						},
						{
							"id": "set-instvar-value",
							"objectClass": "EnemyContainer",
							"sid": 844668927006889,
							"parameters": {
								"instance-variable": "Name",
								"value": "EnemiesArray.At(EnemyArrayIndex, 0)"
							}
						},
						{
							"id": "set-instvar-value",
							"objectClass": "Enemy",
							"sid": 653698736738717,
							"parameters": {
								"instance-variable": "MaxHP",
								"value": "EnemiesArray.At(EnemyArrayIndex,1)"
							}
						},
						{
							"id": "set-animation-frame",
							"objectClass": "Enemy",
							"sid": 785740871005084,
							"parameters": {
								"frame-number": "Functions.GetEnemyAnimationFrame(EnemyContainer.Name)"
							}
						}
					],
					"sid": 156624475077045
				}
			]
		},
		{
			"functionName": "DetermineEnemyChoices",
			"functionDescription": "",
			"functionCategory": "Pick Encounter",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"id": "set-size",
					"objectClass": "LastChosenEnemiesArray",
					"sid": 881277381554600,
					"parameters": {
						"width": "0",
						"height": "2",
						"depth": "1"
					}
				}
			],
			"sid": 150578236901216,
			"children": [
				{
					"eventType": "variable",
					"name": "EnemyArrayIndex",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 541955635723662
				},
				{
					"eventType": "variable",
					"name": "ExcRandomIndexes",
					"type": "string",
					"initialValue": "",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 490927589234477
				},
				{
					"eventType": "comment",
					"text": "EnemyContainer is just a nice way to provide some other instance variables next to our Enemy object (when you select either one, Construct automatically also selects the other), in this case the Name of the enemy (maybe a better way to do this, could just add Name to Enemy object but didn't want to do this until I understood Families better)"
				},
				{
					"eventType": "block",
					"conditions": [],
					"actions": [
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 968669803194556,
							"parameters": {
								"variable": "ExcRandomIndexes",
								"value": "Functions.GetExclusiveRandomIndexes(0,EnemiesArray.Width, EnemyContainer.Count)"
							}
						}
					],
					"sid": 887630385656869
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "for-each-ordered",
							"objectClass": "System",
							"sid": 851635480283148,
							"parameters": {
								"object": "EnemyContainer",
								"expression": "EnemyContainer.X",
								"order": "ascending"
							}
						}
					],
					"actions": [
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 429800346243350,
							"parameters": {
								"variable": "EnemyArrayIndex",
								"value": "tokenat(ExcRandomIndexes,loopindex,\",\")"
							}
						},
						{
							"id": "set-instvar-value",
							"objectClass": "EnemyContainer",
							"sid": 961570677161457,
							"parameters": {
								"instance-variable": "Name",
								"value": "EnemiesArray.At(EnemyArrayIndex, 0)"
							}
						},
						{
							"id": "set-instvar-value",
							"objectClass": "Enemy",
							"sid": 168855413701515,
							"parameters": {
								"instance-variable": "MaxHP",
								"value": "EnemiesArray.At(EnemyArrayIndex,1)"
							}
						},
						{
							"id": "set-animation-frame",
							"objectClass": "Enemy",
							"sid": 382814947472378,
							"parameters": {
								"frame-number": "Functions.GetEnemyAnimationFrame(EnemyContainer.Name)"
							}
						},
						{
							"id": "push",
							"objectClass": "LastChosenEnemiesArray",
							"sid": 697023289930523,
							"parameters": {
								"where": "back",
								"value": "EnemyArrayIndex",
								"axis": "x"
							}
						}
					],
					"sid": 797556986995524
				}
			]
		},
		{
			"functionName": "SetUpEnemiesArray",
			"functionDescription": "",
			"functionCategory": "Pick Encounter",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"id": "set-size",
					"objectClass": "EnemiesArray",
					"sid": 963178354657475,
					"parameters": {
						"width": "0",
						"height": "2",
						"depth": "1"
					}
				}
			],
			"sid": 212393018169459,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "repeat",
							"objectClass": "System",
							"sid": 344246406534154,
							"parameters": {
								"count": "3"
							}
						}
					],
					"actions": [
						{
							"callFunction": "AddEnemyToArray",
							"sid": 822124701447774,
							"parameters": [
								"\"Bot\""
							]
						}
					],
					"sid": 969521703752425
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "repeat",
							"objectClass": "System",
							"sid": 638986151942761,
							"parameters": {
								"count": "3"
							}
						}
					],
					"actions": [
						{
							"callFunction": "AddEnemyToArray",
							"sid": 591274764022986,
							"parameters": [
								"\"Eyes\""
							]
						}
					],
					"sid": 948106663108775
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "repeat",
							"objectClass": "System",
							"sid": 625729036956497,
							"parameters": {
								"count": "2"
							}
						}
					],
					"actions": [
						{
							"callFunction": "AddEnemyToArray",
							"sid": 507809523100008,
							"parameters": [
								"\"Jelly\""
							]
						}
					],
					"sid": 943651847888986
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "repeat",
							"objectClass": "System",
							"sid": 909376344157947,
							"parameters": {
								"count": "2"
							}
						}
					],
					"actions": [
						{
							"callFunction": "AddEnemyToArray",
							"sid": 876985779023562,
							"parameters": [
								"\"Mini-Bot\""
							]
						}
					],
					"sid": 193734325696961
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "repeat",
							"objectClass": "System",
							"sid": 881122969570244,
							"parameters": {
								"count": "2"
							}
						}
					],
					"actions": [
						{
							"callFunction": "AddEnemyToArray",
							"sid": 728984309169299,
							"parameters": [
								"\"One-Eye\""
							]
						}
					],
					"sid": 969470448188365
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "repeat",
							"objectClass": "System",
							"sid": 784981727975609,
							"parameters": {
								"count": "2"
							}
						}
					],
					"actions": [
						{
							"callFunction": "AddEnemyToArray",
							"sid": 351838719231120,
							"parameters": [
								"\"Peeper\""
							]
						}
					],
					"sid": 255292341147451
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "repeat",
							"objectClass": "System",
							"sid": 575471543379697,
							"parameters": {
								"count": "2"
							}
						}
					],
					"actions": [
						{
							"callFunction": "AddEnemyToArray",
							"sid": 854415802662400,
							"parameters": [
								"\"Slither\""
							]
						}
					],
					"sid": 717321510085970
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "repeat",
							"objectClass": "System",
							"sid": 401460697730235,
							"parameters": {
								"count": "2"
							}
						}
					],
					"actions": [
						{
							"callFunction": "AddEnemyToArray",
							"sid": 782420135323962,
							"parameters": [
								"\"Spikey\""
							]
						}
					],
					"sid": 987066163676516
				},
				{
					"eventType": "block",
					"conditions": [],
					"actions": [
						{
							"callFunction": "AddEnemyToArray",
							"sid": 660922381391678,
							"parameters": [
								"\"Scratchy\""
							]
						}
					],
					"sid": 139372029903009
				},
				{
					"eventType": "block",
					"conditions": [],
					"actions": [
						{
							"callFunction": "AddEnemyToArray",
							"sid": 499345743948343,
							"parameters": [
								"\"Intimidator\""
							]
						}
					],
					"sid": 474719075909618
				}
			]
		},
		{
			"functionName": "AddEnemyToArray",
			"functionDescription": "",
			"functionCategory": "Pick Encounter",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "EnemyName",
					"type": "string",
					"initialValue": "",
					"comment": "",
					"sid": 535793591136013
				}
			],
			"eventType": "function-block",
			"conditions": [],
			"actions": [],
			"sid": 586637068082575,
			"children": [
				{
					"eventType": "variable",
					"name": "HP",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 176740646832586
				},
				{
					"eventType": "block",
					"conditions": [],
					"actions": [
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 174107200682512,
							"parameters": {
								"variable": "HP",
								"value": "Functions.ParseDice(Functions.GetEnemyMaxHPRoll(EnemyName))"
							}
						},
						{
							"id": "push",
							"objectClass": "EnemiesArray",
							"sid": 640275530565556,
							"parameters": {
								"where": "back",
								"value": "EnemyName",
								"axis": "x"
							}
						},
						{
							"id": "set-at-xy",
							"objectClass": "EnemiesArray",
							"sid": 259728042181401,
							"parameters": {
								"x": "EnemiesArray.Width - 1",
								"y": "1",
								"value": "HP"
							}
						}
					],
					"sid": 350355912486525
				}
			]
		},
		{
			"functionName": "GetEnemyDamageRoll",
			"functionDescription": "",
			"functionCategory": "Enemy Info",
			"functionReturnType": "string",
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "EnemyName",
					"type": "string",
					"initialValue": "",
					"comment": "",
					"sid": 988341777660204
				}
			],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"id": "set-function-return-value",
					"objectClass": "Functions",
					"sid": 872856031314889,
					"parameters": {
						"value": "JSON.Get(\"enemies.\" & EnemyName & \".damageRoll\")"
					}
				}
			],
			"sid": 354104725184138
		},
		{
			"functionName": "GetEnemyMaxHPRoll",
			"functionDescription": "",
			"functionCategory": "Enemy Info",
			"functionReturnType": "string",
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "EnemyName",
					"type": "string",
					"initialValue": "",
					"comment": "",
					"sid": 918263087737735
				}
			],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"id": "set-function-return-value",
					"objectClass": "Functions",
					"sid": 949039811725534,
					"parameters": {
						"value": "JSON.Get(\"enemies.\" & EnemyName & \".maxHPRoll\")"
					}
				}
			],
			"sid": 774049048371281
		},
		{
			"functionName": "GetEnemyAnimationFrame",
			"functionDescription": "",
			"functionCategory": "Enemy Info",
			"functionReturnType": "number",
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "EnemyName",
					"type": "string",
					"initialValue": "",
					"comment": "",
					"sid": 411395220729109
				}
			],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"id": "set-function-return-value",
					"objectClass": "Functions",
					"sid": 451948194864014,
					"parameters": {
						"value": "JSON.Get(\"enemies.\" & EnemyName & \".animationFrame\")"
					}
				}
			],
			"sid": 330652757158538
		},
		{
			"functionName": "GetEnemyLevel",
			"functionDescription": "",
			"functionCategory": "Enemy Info",
			"functionReturnType": "string",
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "EnemyName",
					"type": "string",
					"initialValue": "",
					"comment": "",
					"sid": 286997707250925
				}
			],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"id": "set-function-return-value",
					"objectClass": "Functions",
					"sid": 155879025276238,
					"parameters": {
						"value": "JSON.Get(\"enemies.\" & EnemyName & \".level\")"
					}
				}
			],
			"sid": 838548536423737
		},
		{
			"eventType": "comment",
			"text": "Gets amount random numbers in the range between minInclusive and maxExclusive without repeating and returns a comma separated string with the results"
		},
		{
			"eventType": "comment",
			"text": "Example: GetExclusiveRandomIndexes(3,9,4) = \"4,8,1,2,\""
		},
		{
			"functionName": "GetExclusiveRandomIndexes",
			"functionDescription": "",
			"functionCategory": "Utility",
			"functionReturnType": "string",
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "minInclusive",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"sid": 853910010500688
				},
				{
					"name": "maxExclusive",
					"type": "number",
					"initialValue": "1",
					"comment": "",
					"sid": 362666385815550
				},
				{
					"name": "amount",
					"type": "number",
					"initialValue": "1",
					"comment": "",
					"sid": 486820658574669
				}
			],
			"eventType": "function-block",
			"conditions": [],
			"actions": [],
			"sid": 661341129978975,
			"children": [
				{
					"eventType": "variable",
					"name": "result",
					"type": "string",
					"initialValue": "\"\"",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 683838942480998
				},
				{
					"eventType": "block",
					"conditions": [],
					"actions": [
						{
							"type": "script",
							"script": "function randomInteger(minInc, maxExc) {\n  return Math.floor(Math.random() * (maxExc - minInc) + minInc)\n}\n\nlet result = \"\"\nlet choices = []\nfor (let i = localVars.minInclusive; i < localVars.maxExclusive; i++){\n  choices.push(i)\n}\n\nfor (let j = 0; j < localVars.amount; j++){\n  if (choices.length === 0){\n    break\n  }\n  let choice = randomInteger(0, choices.length)\n  result += `${choices[choice]},`\n  choices.splice(choice, 1)\n}\nlocalVars.result = result"
						},
						{
							"id": "set-function-return-value",
							"objectClass": "Functions",
							"sid": 971408029911315,
							"parameters": {
								"value": "result"
							}
						}
					],
					"sid": 243029658016327
				}
			]
		}
	],
	"sid": 377988339899397
}